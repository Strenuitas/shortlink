# 短链接监控

跳转的同时提供监控信息：访问次数----每跳转一次就记录一次     pv                  pv uv uip 24小时分布  一周访问 记录在t_link_access_stats 基础监控信息    包含gid既然短链接分表了，这个监控信息当然也是要分表的 fullshorturl是因为我们每次请求的时候，要根据这个去查单条记录并增加 以及date  只带年月日  
                        访问人数----根据用户  uv                                  这里我们具体如何设计24小时分布和一周分布 也就是把一周分为 7*24 这样进行记录  
                        IP数--------统计同一IP下访问次数  uip  
                        访问地区----  中国地图 调用高德api   
                        24小时分布--用户访问的时间    
                        高频IP------记录访问次数高的   
                        一周访问----具体周几   
                        操作系统----windows linux macOS   
                        访问浏览器--firefox chrome edge
                        访客类型----分为新老访客   
                        访问网络----wifi 移动数据   
                        访问设备----电脑 移动设备   
# 先做基础访问 pv uv uip 24小时访问 一周访问
具体如何进行数据统计呢？   有比较好的方案比如自增 redis里面的increment命令就挺好，但是我们这是使用mysql没有increment命令，可以使用这样 如果某条记录存在  原有基础上加一，如果不存在，设置初始值     
```
INSERT INTO
  t_link_access_stats (
    full_short_url,
    gid,
    date,
    pv,
    uv,
    uip,
    hour,
    weekday,
    create_time,
    update_time,
    del_flag
  )
VALUES(
    'nurl.ink/W5M7a',
    'siCwZo',
    '2023-11-04',
    0,
    0,
    0,
    0,
    0,
    NOW(),
    NOW(),
    0
  ) ON DUPLICATE KEY
UPDATE
  pv = pv + 1,
  uv = uv + 2,
  uip = uip + 3;
```

# 数据一致性指的是缓存和数据库之间   基于项目是redis 和DB  之后就以这俩讨论
数据库和缓存要更新一致，就要有是先更新数据库还是更新缓存。

# 先更新缓存，在更新数据库
我们讨论它的异常情况：也就是一二步，第二步失败了会怎么办。 即 更新缓存，数据库更新失败，这时候不一致。之后的请求仍然是拿到的新值，但是缓存有过期时间，你不可能让他一直存在而占用内存，这样缓存过期访问数据库就会拿到旧值同时重新构建缓存也是旧值。用户场景就是用户更新数据用了没多久发现数据又变回去了，对业务造成很大危险。  

# 先更新数据库，在更新缓存。
也是第二步失败，即数据库是最新的，但是缓存没更新，这样就是完全的数据不一致，之后的用户去缓存里取的是旧值，也就是用户改完后发现没有生效，不过这种情况小概率，因为缓存是本地内存，更新缓存是很快的。不过这样还是有问题，比方说redis集群宕机了一个头结点，推举新的领导结点的时候，它没有获取到要更新的缓存的这个命令  
也就是原来头结点更新缓存是很快，但是它发给集群的子结点的时候这个过程相对来说长一点，这时候头结点宕机，发送失败，从节点可能收不到信息，推举新的头结点的时候，原来的主节点变成了从节点，向新的主节点进行全量同步，同步之前要清空自己的数据，也就是这个数据可能就丢失掉了。

# 除了操作失败，还有并发也会影响数据一致性

### 先更新缓存，后更新数据库
A请求先更新，更新缓存A从1-2
B请求更新，更新缓存从2-3或者是1-3
B更新数据库，更新数据库1-3
A更新数据库，更新数据库从3-2  缓存中是3，而数据库中是2
### 先更新数据库，再更新缓存
A请求更新
